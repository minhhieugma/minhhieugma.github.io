<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/Users/hieu.le/sources/lambton/Software Tools and Emerging Technologies for AI and ML/my-weather-app/Tests/MockHttpClientBunitHelpers.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Bunit;
using Microsoft.Extensions.DependencyInjection;
using RichardSzalay.MockHttp;
using System;
using System.Net;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text.Json;

public static class MockHttpClientBunitHelpers
{
    public static MockHttpMessageHandler AddMockHttpClient(this TestServiceProvider services)
    {
        var mockHttpHandler = new MockHttpMessageHandler();
        var httpClient = mockHttpHandler.ToHttpClient();
        httpClient.BaseAddress = new Uri(&quot;http://localhost&quot;);
        services.AddSingleton&lt;HttpClient&gt;(httpClient);
        return mockHttpHandler;
    }

    public static MockedRequest RespondJson&lt;T&gt;(this MockedRequest request, T content)
    {
        request.Respond(req =&gt;
        {
            var response = new HttpResponseMessage(HttpStatusCode.OK);
            response.Content = new StringContent(JsonSerializer.Serialize(content));
            response.Content.Headers.ContentType = new MediaTypeHeaderValue(&quot;application/json&quot;);
            return response;
        });
        return request;
    }

    public static MockedRequest RespondJson&lt;T&gt;(this MockedRequest request, Func&lt;T&gt; contentProvider)
    {
        request.Respond(req =&gt;
        {
            var response = new HttpResponseMessage(HttpStatusCode.OK);
            response.Content = new StringContent(JsonSerializer.Serialize(contentProvider()));
            response.Content.Headers.ContentType = new MediaTypeHeaderValue(&quot;application/json&quot;);
            return response;
        });
        return request;
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,5,13,6,1],[14,9,14,60,1],[15,9,15,57,1],[16,9,16,62,1],[17,9,17,55,1],[18,9,18,32,1],[19,5,19,6,1],[22,5,22,6,1],[23,9,24,9,1],[24,9,24,10,1],[24,10,25,13,1],[25,13,25,71,1],[25,71,26,13,1],[26,13,26,85,1],[26,85,27,13,1],[27,13,27,97,1],[27,97,28,13,1],[28,13,28,29,1],[28,29,29,9,1],[29,9,29,10,1],[29,10,29,12,1],[30,9,30,24,1],[31,5,31,6,1],[34,5,34,6,0],[35,9,36,9,0],[36,9,36,10,0],[36,10,37,13,0],[37,13,37,71,0],[37,71,38,13,0],[38,13,38,95,0],[38,95,39,13,0],[39,13,39,97,0],[39,97,40,13,0],[40,13,40,29,0],[40,29,41,9,0],[41,9,41,10,0],[41,10,41,12,0],[42,9,42,24,0],[43,5,43,6,0]]);
    </script>
  </body>
</html>